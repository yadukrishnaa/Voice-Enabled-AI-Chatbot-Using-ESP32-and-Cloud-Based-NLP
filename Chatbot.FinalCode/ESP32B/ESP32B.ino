/* ESP32 B
   - Idle: Eye animation
   - Busy: Bitmap animation (Listening & Processing)
   - Audio start: switch to Idle
   - FIXED: Stable TTS playback for unlimited attempts
*/

#include <WiFi.h>
#include <WebServer.h>
#include "Audio.h"
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

// ================= WIFI =================
const char* ssid = "SSID";
const char* password = "PASSWORD";

// ================= AUDIO =================
#define I2S_DOUT 26
#define I2S_BCLK 25
#define I2S_LRC  27

Audio* audio = nullptr;
WebServer server(8000);

// ================= OLED =================
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_ADDR 0x3C
#define OLED_SDA 21
#define OLED_SCL 22

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

// ================= BUSY ANIMATION =================
#define FRAME_DELAY 42
#define FRAME_WIDTH 64
#define FRAME_HEIGHT 64

// ðŸ”¹ KEEP YOUR frames[][512] ARRAY HERE (UNCHANGED)
const byte PROGMEM frames[][512] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,3,0,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,193,192,0,0,3,131,0,0,193,192,0,0,3,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,192,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,192,193,193,193,131,131,131,3,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,192,0,0,3,131,0,0,193,192,0,0,3,131,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,0,192,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,131,0,0,1,193,128,0,3,131,0,0,193,193,192,0,3,131,0,0,193,193,192,0,3,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,192,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,192,193,193,193,131,131,131,3,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,0,3,131,0,0,193,193,192,0,3,131,0,0,1,193,128,0,3,131,0,0,1,192,0,0,3,131,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,0,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,131,0,0,1,193,128,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,193,193,192,0,3,131,0,0,193,193,192,1,3,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,192,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,192,193,193,193,131,131,131,3,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,1,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,128,0,3,131,0,0,1,192,0,0,3,131,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,0,192,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,192,0,0,1,0,0,0,1,192,0,0,3,131,0,0,1,193,128,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,193,193,192,1,3,131,0,64,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,64,193,193,193,131,131,131,3,0,193,193,192,1,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,128,0,3,131,0,0,1,192,0,0,3,131,0,0,0,192,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,3,0,0,0,129,192,0,0,3,0,0,1,193,192,0,3,3,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,64,1,193,193,128,3,131,3,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,3,131,7,64,1,193,193,128,3,131,3,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,3,0,0,0,129,192,0,0,3,0,0,0,0,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,193,192,0,0,3,0,0,1,193,192,0,3,3,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,64,1,193,193,128,3,131,3,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,3,131,7,224,1,193,193,128,3,131,7,192,1,193,193,128,3,131,7,64,1,193,192,0,3,131,3,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,131,0,0,1,193,192,0,3,3,0,0,0,193,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,0,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,1,193,192,0,0,3,0,0,1,193,192,0,3,3,0,0,1,193,192,0,3,131,2,0,1,193,192,0,3,131,7,192,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,131,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,192,1,193,193,128,3,131,7,0,1,193,192,0,3,131,3,0,1,193,192,0,3,131,2,0,1,193,192,0,3,3,0,0,0,193,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,129,192,0,0,3,2,0,1,193,192,0,0,3,7,192,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,131,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,192,1,193,193,128,3,131,7,0,1,193,192,0,0,3,7,0,0,129,192,0,0,3,2,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,3,192,0,1,193,128,0,3,7,224,0,129,193,128,0,3,7,224,1,193,193,128,0,3,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,131,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,0,3,7,224,0,1,193,128,0,3,7,192,0,1,193,128,0,3,7,0,0,1,192,0,0,3,3,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,3,192,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,129,193,128,0,3,7,224,1,193,193,128,1,3,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,3,131,7,224,1,193,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,192,0,1,193,128,0,3,7,0,0,1,192,0,0,3,3,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,0,0,0,1,128,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,192,0,0,3,0,0,0,1,192,0,0,3,2,192,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,1,193,193,128,1,3,7,224,193,193,193,129,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,129,3,131,7,224,1,193,193,128,1,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,192,0,1,193,128,0,3,7,0,0,1,192,0,0,3,2,0,0,1,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,3,224,0,0,129,128,0,0,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,192,1,193,129,0,3,7,224,193,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,193,193,131,129,3,7,224,192,1,193,129,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,0,129,128,0,0,7,64,0,0,1,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,1,128,0,0,3,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,1,129,128,0,0,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,192,1,193,129,0,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,193,193,131,129,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,129,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,192,0,0,1,128,0,0,7,64,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,192,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,1,193,128,0,0,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,193,193,131,131,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,193,128,0,3,7,224,0,1,129,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,192,0,0,1,128,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,3,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,129,128,0,0,7,224,0,1,193,128,0,0,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,193,193,131,131,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,0,1,193,128,0,0,7,224,0,0,129,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,192,0,0,1,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,3,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,192,0,1,129,128,0,7,224,192,0,129,131,128,0,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,193,193,131,131,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,129,128,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,192,0,0,1,128,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,1,128,0,0,2,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,192,0,1,129,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,129,131,128,0,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,129,193,131,129,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,3,7,224,192,1,193,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,129,128,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,224,0,0,1,128,0,0,7,192,0,0,1,128,0,0,3,64,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,3,224,0,0,1,128,0,0,7,224,192,0,1,129,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,1,193,131,128,3,7,224,192,193,193,131,131,3,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,192,129,193,131,129,3,7,224,192,1,193,131,128,3,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,129,128,0,7,224,0,0,1,128,0,0,7,64,0,0,1,128,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,0,192,0,0,3,128,0,0,192,192,0,1,131,128,0,3,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,128,1,131,129,0,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,129,131,131,131,7,224,192,128,1,131,129,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,192,192,0,1,131,128,0,3,0,192,0,0,3,128,0,0,0,192,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,0,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,192,192,0,1,131,128,0,3,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,128,1,131,129,0,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,129,131,131,131,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,192,192,0,1,131,128,0,3,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,128,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,192,192,0,1,131,128,0,3,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,129,131,131,131,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,192,0,1,131,128,0,7,224,192,0,1,131,128,0,7,192,192,0,1,131,128,0,3,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,192,193,192,1,131,131,128,3,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,129,131,131,131,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,3,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,0,0,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,192,0,3,131,0,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,192,193,192,1,131,131,128,3,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,129,131,131,131,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,3,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,192,192,0,3,131,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,0,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,192,0,3,131,0,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,64,193,192,1,131,131,128,2,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,7,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,192,129,131,131,131,7,224,193,192,1,131,131,128,7,224,193,192,1,131,131,128,3,64,193,192,0,3,131,128,2,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,192,192,0,3,131,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,3,128,0,0,0,192,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,1,128,0,0,0,192,0,0,3,128,0,0,0,192,192,0,3,131,0,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,64,193,192,1,131,131,128,2,224,193,193,129,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,192,129,131,131,131,7,64,193,192,1,131,131,128,2,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,192,192,0,3,131,0,0,0,192,0,0,3,128,0,0,0,192,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,1,0,0,0,193,192,0,0,3,128,0,0,193,192,0,1,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,128,3,131,131,0,64,193,193,193,131,131,131,2,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,64,193,193,193,131,131,131,2,0,193,192,128,3,131,131,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,1,131,128,0,0,193,192,0,0,3,128,0,0,0,128,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,1,0,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,193,192,0,0,3,128,0,0,193,192,0,1,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,131,0,0,193,192,128,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,192,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,192,193,193,193,131,131,131,3,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,192,128,3,131,131,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,3,131,128,0,0,193,192,0,1,131,128,0,0,193,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,0,128,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,193,192,0,0,3,128,0,0,193,192,0,1,131,128,0,0,193,192,0,3,131,131,0,0,193,192,0,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,192,193,193,193,131,131,131,3,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,224,193,193,193,131,131,131,7,192,193,193,193,131,131,131,3,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,193,192,3,131,131,0,0,193,192,0,3,131,131,0,0,193,192,0,3,131,131,0,0,193,192,0,1,131,128,0,0,193,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,1,192,0,0,3,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}


};
const uint8_t FRAME_COUNT = sizeof(frames) / sizeof(frames[0]);

uint8_t busyFrameIndex = 0;
unsigned long lastBusyFrameTime = 0;

// ================= IDLE EYES =================
int ANIM_DELAY = 60;
const int EH = 40, EW = 40, GAP = 10, RADIUS = 10;

struct EyeState { int h, w, x, y; };
EyeState L, R;
int corner_radius = RADIUS;

unsigned long lastBlink = 0;
unsigned long nextBlinkDelay = 1500;

// ================= STATE =================
bool isBusy = false;

// ================= AUDIO RESET (CRITICAL FIX) =================
void resetAudio() {
  if (audio) {
    delete audio;
  }
  audio = new Audio();
  audio->setPinout(I2S_BCLK, I2S_LRC, I2S_DOUT);
  audio->setVolume(18);   // ðŸ”Š increase if needed (0â€“21 safe)
}

// ================= OLED HELPERS =================
void initDisplay() {
  Wire.begin(OLED_SDA, OLED_SCL);
  display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDR);
  display.clearDisplay();
  display.setTextColor(SSD1306_WHITE);
}

void resetEyes() {
  L = {EH, EW, SCREEN_WIDTH/2 - EW/2 - GAP/2, SCREEN_HEIGHT/2};
  R = {EH, EW, SCREEN_WIDTH/2 + EW/2 + GAP/2, SCREEN_HEIGHT/2};
  corner_radius = RADIUS;
}

void drawEyes() {
  display.clearDisplay();
  display.fillRoundRect(L.x - L.w/2, L.y - L.h/2, L.w, L.h, corner_radius, SSD1306_WHITE);
  display.fillRoundRect(R.x - R.w/2, R.y - R.h/2, R.w, R.h, corner_radius, SSD1306_WHITE);
  display.display();
}

void blinkEyes() {
  for (int i = 0; i < 3; i++) {
    L.h -= 10; R.h -= 10;
    corner_radius = max(1, L.h/2);
    drawEyes(); delay(ANIM_DELAY);
  }
  for (int i = 0; i < 3; i++) {
    L.h += 10; R.h += 10;
    corner_radius = min(RADIUS, L.h/2);
    drawEyes(); delay(ANIM_DELAY);
  }
}

// ================= BUSY FRAME DRAW =================
void drawBusyFrame() {
  display.clearDisplay();
  display.drawBitmap(
    (SCREEN_WIDTH - FRAME_WIDTH) / 2,
    (SCREEN_HEIGHT - FRAME_HEIGHT) / 2,
    frames[busyFrameIndex],
    FRAME_WIDTH,
    FRAME_HEIGHT,
    1
  );
  display.display();
}

// ================= TTS HELPERS =================
String urlEncode(const String &s) {
  String enc;
  char buf[8];
  for (char c : s) {
    if (isalnum(c)) enc += c;
    else if (c == ' ') enc += "%20";
    else {
      sprintf(buf, "%%%02X", (uint8_t)c);
      enc += buf;
    }
  }
  return enc;
}

String buildTTSUrl(const String &text) {
  return "http://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=en&q=" +
         urlEncode(text);
}

// ================= HTTP HANDLERS =================
void handleBusy() {
  server.send(200, "text/plain", "OK");
  isBusy = true;
  busyFrameIndex = 0;
  lastBusyFrameTime = 0;
}

void handleIdle() {
  server.send(200, "text/plain", "OK");
  isBusy = false;
  resetEyes();
  drawEyes();
}

void handlePlay() {
  String body = server.arg("plain");
  int i = body.indexOf("\"text\"");
  if (i < 0) {
    server.send(400, "text/plain", "Bad JSON");
    return;
  }
  int s = body.indexOf("\"", i + 6);
  int e = body.indexOf("\"", s + 1);
  String text = body.substring(s + 1, e);

  server.send(200, "text/plain", "Accepted");

  // Switch to IDLE animation BEFORE audio starts
  isBusy = false;
  resetEyes();
  drawEyes();

  // ðŸ”¥ CRITICAL FIX: reset Audio BEFORE every play
  resetAudio();
  audio->connecttohost(buildTTSUrl(text).c_str());
}

void handleStop() {
  server.send(200, "text/plain", "Stopped");
  resetAudio();
  isBusy = false;
  resetEyes();
  drawEyes();
}

// ================= SETUP =================
void setup() {
  Serial.begin(115200);

  initDisplay();
  resetEyes();
  drawEyes();

  resetAudio();

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) delay(300);

  server.on("/busy", HTTP_POST, handleBusy);
  server.on("/idle", HTTP_POST, handleIdle);
  server.on("/play", HTTP_POST, handlePlay);
  server.on("/stop", HTTP_POST, handleStop);
  server.begin();

  randomSeed(analogRead(34));
}

// ================= LOOP =================
void loop() {
  server.handleClient();

  if (audio && audio->isRunning()) {
    audio->loop();
  }

  unsigned long now = millis();

  if (isBusy) {
    if (now - lastBusyFrameTime >= FRAME_DELAY) {
      lastBusyFrameTime = now;
      drawBusyFrame();
      busyFrameIndex = (busyFrameIndex + 1) % FRAME_COUNT;
    }
  } else {
    if (now - lastBlink >= nextBlinkDelay) {
      blinkEyes();
      lastBlink = now;
      nextBlinkDelay = random(1000, 3000);
    }
  }

  delay(3);
}
